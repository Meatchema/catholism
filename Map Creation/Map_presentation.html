<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Map presentation</title>
    <style>
        /* Layout */
        .container { display: flex; gap: 16px; align-items: flex-start; max-width: 1100px; margin: 20px auto; }
        #map { width: 700px; height: 600px; border: 1px solid #ccc; box-sizing: border-box; }
        .side-panel { width: 360px; padding: 12px; border: 1px solid #ccc; background: #f9f9f9; box-sizing: border-box; }
        .side-panel h1 { margin: 0 0 8px 0; font-size: 1.25rem; }
    </style>
</head>
<body>

    <div class="container">
        <!-- Map target (library will render here) -->
        <div id="map"></div>

        <!-- Simple info panel updated from map click hooks -->
        <div class="side-panel">
            <h1 id="info-title">Select a location</h1>
            <div id="info-desc">Click a marker on the map to see details here.</div>
        </div>
    </div>

        <!-- Load an inline copy of your downloaded SVG and add SVG markers programmatically -->
            <style>
                /* SVG marker styles */
                .my-marker circle { cursor: pointer; filter: drop-shadow(0 1px 1px rgba(0,0,0,.25)); }
                .my-marker text { pointer-events: none; font-family: Arial, Helvetica, sans-serif; font-size: 12px; }
            </style>

            <!-- external marker data (editable) -->
            <script src="mapdata.js"></script>

            <script>
                const svgFile = 'world(1).svg'; // ensure this file is in the same folder

            function updateSidePanelByData(data){
                const title = document.getElementById('info-title');
                const desc = document.getElementById('info-desc');
                if(!data){ title.textContent='Select a location'; desc.textContent='Click a marker on the map to see details here.'; return; }
                title.textContent = data.name || 'Location';
                desc.innerHTML = data.description || '';
            }

                    // markers: prefer external `window.custom_mapdata.markers` (from mapdata.js)
                    const markers = (window.custom_mapdata && Array.isArray(window.custom_mapdata.markers))
                        ? window.custom_mapdata.markers
                        : [
                                { id: 'm0', name: 'New York', fx: 0.50, fy: 0.30, description: 'New York City' },
                                { id: 'm1', name: 'London',   fx: 0.60, fy: 0.40, description: 'London, UK' },
                                { id: 'm2', name: 'Tokyo',    fx: 0.70, fy: 0.50, description: 'Tokyo, Japan' }
                            ];

            // Try to fetch the SVG and inline it. Fallback to <object> if fetch fails (file:// or CORS).
            async function loadAndInjectSVG(){
                const mapDiv = document.getElementById('map');
                try{
                    const res = await fetch(svgFile);
                    if(!res.ok) throw new Error('Fetch failed');
                    const svgText = await res.text();
                    mapDiv.innerHTML = svgText;
                    const svg = mapDiv.querySelector('svg');
                    if(!svg) throw new Error('No <svg> element found');
                    finalizeSVG(svg);
                }catch(err){
                    // Fallback: use object element and wait for load
                    console.warn('Fetch inline SVG failed, falling back to <object>:', err);
                    mapDiv.innerHTML = '';
                    const obj = document.createElement('object');
                    obj.type = 'image/svg+xml';
                    obj.data = svgFile;
                    obj.style.width = '100%'; obj.style.height = '100%';
                    mapDiv.appendChild(obj);
                    obj.addEventListener('load', function(){
                        try{ const svg = obj.contentDocument && obj.contentDocument.documentElement; if(svg) finalizeSVG(svg); }
                        catch(e){ console.error('Could not access SVG inside object:', e); }
                    });
                }
            }

            function getViewBox(svg){
                let vb = svg.getAttribute('viewBox');
                if(vb){ const parts = vb.split(/\s+/).map(Number); return { x: parts[0], y: parts[1], width: parts[2], height: parts[3] }; }
                // fallback to width/height attributes
                const w = parseFloat(svg.getAttribute('width')) || svg.clientWidth || 1000;
                const h = parseFloat(svg.getAttribute('height')) || svg.clientHeight || 600;
                return { x: 0, y: 0, width: w, height: h };
            }

            function finalizeSVG(svg){
                // Make responsive
                svg.setAttribute('width','100%');
                svg.setAttribute('height','100%');
                const vb = getViewBox(svg);

                // helper to add a marker at fractional coords
                function addMarker(m){
                    const ns = 'http://www.w3.org/2000/svg';
                    const g = document.createElementNS(ns,'g');
                    g.setAttribute('class','my-marker');
                    g.setAttribute('data-id', m.id);
                    const x = vb.x + (m.fx * vb.width);
                    const y = vb.y + (m.fy * vb.height);

                    const circle = document.createElementNS(ns,'circle');
                    circle.setAttribute('cx', x);
                    circle.setAttribute('cy', y);
                    circle.setAttribute('r', Math.max(4, vb.width * 0.008));
                    circle.setAttribute('fill', '#e74c3c');
                    circle.setAttribute('stroke', '#fff');
                    circle.setAttribute('stroke-width', 1.5);

                    const text = document.createElementNS(ns,'text');
                    text.setAttribute('x', x + Math.max(8, vb.width * 0.012));
                    text.setAttribute('y', y + Math.max(4, vb.height * 0.01));
                    text.setAttribute('fill', '#111');
                    text.setAttribute('font-size', Math.max(10, vb.width * 0.01));
                    text.textContent = m.name;

                    g.appendChild(circle);
                    g.appendChild(text);

                    // click handler
                    g.addEventListener('click', function(){ updateSidePanelByData(m); });

                    // accessibility: keyboard
                    g.setAttribute('tabindex', 0);
                    g.addEventListener('keydown', function(e){ if(e.key==='Enter' || e.key===' ') updateSidePanelByData(m); });

                    // append to svg
                    svg.appendChild(g);
                }

                // Add all markers
                markers.forEach(addMarker);

                // Optionally show first marker info
                if(markers.length) updateSidePanelByData(markers[0]);
            }

            // start
            loadAndInjectSVG();
        </script>

</body>
</html>